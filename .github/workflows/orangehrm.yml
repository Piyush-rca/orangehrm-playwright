name: OrangeHRM Automation - Scheduled Run

on:
  schedule:
    # Runs every day at 6 AM IST (00:30 UTC)
    - cron: '*/15 * * * *'
  workflow_dispatch:   # allows manual trigger also

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout code
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Step 2: Setup Java
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # Step 3: Setup Maven cache
      - name: Cache Maven packages
        uses: actions/cache@v4
        with:
          path: ~/.m2
          key: maven-${{ hashFiles('**/pom.xml') }}
          restore-keys: maven-

      # Step 4: Install Playwright browsers
      - name: Install Playwright Browsers
        run: mvn exec:java -e -Dexec.mainClass=com.microsoft.playwright.CLI -Dexec.args="install"

      # Step 5: Run Tests
      - name: Run TestNG Suite
        run: mvn clean test

      # Step 6: Upload Test Reports
      - name: Upload Test Reports
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: orangehrm-test-reports
          path: |
            test-output
            build
